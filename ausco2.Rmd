---
title: "Australia CO2 emission"
author: "Aphiaut Imuan"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(readxl)
library(GGally)
library(mgcv)
library(broom)
library(visreg)
```

```{r}
co2 <- read_csv("data/co-emissions-per-capita.csv") %>%
  filter(Entity == "Australia",
         Year >= 1996) %>%
  rename("year" = "Year",
         "co2_capita" = "Annual COâ‚‚ emissions (per capita)") %>%
  select(year, co2_capita)


pop <- read_csv("data/API_SP.POP.TOTL_DS2_en_csv_v2_5551506.csv", skip = 4) %>%
  pivot_longer(cols = 5:67, names_to = "year", values_to = "total_pop") %>%
  rename("country" = "Country Name") %>%
  filter(country == "Australia",
         year >= 1996) %>%
  select(c(year, total_pop)) %>%
  na.omit() %>%
  mutate(year = as.numeric(year))


migrant <- read_csv("data/API_SM.POP.NETM_DS2_en_csv_v2_5551569.csv", skip = 4) %>%
  pivot_longer(cols = 5:67, names_to = "year", values_to = "net_migrant") %>%
  rename("country" = "Country Name") %>%
  filter(country == "Australia",
         year >= 1996,
         year < 2022) %>%
  select(c(year, net_migrant)) %>%
  na.omit() %>%
  mutate(year = as.numeric(year))


gdp <- read_csv("data/API_NY.GDP.PCAP.KD_DS2_en_csv_v2_5551580.csv", skip = 4) %>%
  pivot_longer(cols = 5:67, names_to = "year", values_to = "gdp_capita") %>%
  rename("country" = "Country Name") %>%
  filter(country == "Australia",
         year >= 1996) %>%
  select(c(year, gdp_capita)) %>%
  na.omit() %>%
  mutate(year = as.numeric(year))


myCols <- as.character(read_excel("data/Australian Energy Statistics 2021 Table B_0.xlsx", sheet = "AUS", skip = 4, n_max = 1, col_names = FALSE))
myCols <- c("year", myCols)

energy <- read_excel("data/Australian Energy Statistics 2021 Table B_0.xlsx", sheet = "AUS", skip = 6, col_names = myCols) %>% 
  na.omit() %>%
  filter(as.numeric(sub("-.*", "", year)) %in% 1996:2021) %>%
  mutate(year = as.numeric(sub("-.*", "", year))) %>%
  select(c("year", "Energy consumption")) %>%
  rename("energy_consumption" = "Energy consumption")

co2_new<- co2 %>%
  right_join(pop, by = "year") %>%
  right_join(migrant, by = "year") %>%
  right_join(gdp, by = "year") %>%
  right_join(energy, by = "year")

```

# Data Description

CO2 emission from [Our World in Data](https://ourworldindata.org/co2/country/australia) This data focus on 25 year 1996-2021
Energy data from  [Department of Climate Change, Energy, the Environment and Water](https://www.energy.gov.au/publications/australian-energy-update-2021)
Population data from  [World Bank database](https://data.worldbank.org/indicator/SP.POP.TOTL?locations=AU)
Net migration data from  [World Bank database](https://data.worldbank.org/indicator/SM.POP.NETM?locations=AU)
GDP per capita constant 2015$ US [World Bank database](https://data.worldbank.org/indicator/NY.GDP.MKTP.KD?locations=AU)

# Theory for this report
IPAT theory or The Environmental Impacts (I) on Population (P), Affluence (A), and Technology (T)
EKC theory or the environmental Kuznets curve created by Simon Smith Kuznets


```{r}
ggpairs(co2_new)
```

From the figure illustrates correlations between CO2 and predictors are not linear relationship, therefore all predictors need to transform. In this transformation based on the Stochastic Regression on Population, Affluence and Technology (STIRPAT) framework because the IPAT model is theory that not useful for statistic. However, this framework has a drawback that the correlation between response variable and predictors are linear relationship. 

```{r}
co2_trans <- co2_new %>%
  mutate(total_pop = log(total_pop),
         net_migrant = log(net_migrant),
         gdp_capita = log(gdp_capita),
         energy_consumption = log(energy_consumption),
         co2_capita = log(co2_capita))
```

```{r}
co2_trans %>%
  dplyr::select(-year) %>%
  GGally::ggpairs(aes(alpha=.1))
```

This graph shows the relationship between CO2 per capita and all predictors are not linear relationship. Therefore, STIRPAT framework is not suitable to this report. 


Therefore, the statistic model is relevant with this dataset should be non-parametric regression.

```{r}
lmod_1 <- lm(co2_capita ~ total_pop + net_migrant + gdp_capita + energy_consumption + total_pop:net_migrant + total_pop:gdp_capita + total_pop:energy_consumption, data = co2_trans)

summary(lmod_1)
```
```{r}
broom::augment(lmod_1) %>%
  ggplot() +
  geom_qq(aes(sample=.resid))
```


All p-value of predictors are not significant. It means they do not have enough evidence to conclude that predictors affect to CO2 emission per capita in Australia.

```{r}
co2_trans %>%
  ggplot(aes(x = total_pop, y = co2_capita)) +
  geom_smooth() + 
  geom_point()
```


```{r}
co2_trans %>%
  ggplot(aes(x = gdp_capita, y = co2_capita)) +
  geom_smooth()
```

```{r}
co2_trans %>%
  ggplot(aes(x = energy_consumption, y = co2_capita)) +
  geom_smooth()
```

```{r}
fit <- mgcv::gam(co2_capita ~ s(total_pop, bs = 'cr', k = 3) + s(net_migrant, by = total_pop, bs = 'cr', k = 3) + s(gdp_capita, by = total_pop, bs = 'cr', k = 3) + s(energy_consumption, by = total_pop, bs = 'cr', k = 3), data = co2_trans)
```

```{r}
visreg(fit, plot=FALSE) %>%
purrr::map(function(x){plot(x, gg=TRUE)+theme_bw()}) %>%
gridExtra::marrangeGrob(ncol=2, nrow=2)
```
```{r}
summary(fit)
```

```{r}
fit_2 <- mgcv::gam(co2_capita ~ s(total_pop, bs = 'cr', k = 3) + s(net_migrant, by = total_pop, bs = 'cr', k = 3) + s(gdp_capita, by = total_pop, bs = 'cr', k = 3) + s(energy_consumption, by = total_pop, bs = 'cr', k = 3) + 
                     s(net_migrant, bs = 'cr', k = 3) + s(gdp_capita, bs = 'cr', k = 3) + s(energy_consumption,  bs = 'cr', k = 3), data = co2_trans)

```

```{r}
summary(fit_2)
```


```{r}
visreg(fit_2, plot=FALSE) %>%
purrr::map(function(x){plot(x, gg=TRUE)+theme_bw()}) %>%
gridExtra::marrangeGrob(ncol=2, nrow=2)
```

```{r}
anova(fit, fit_2, test = "F")
```




Technology is positive -> doesn't enough hechnology level and Furthermore, some studies such as Talbi (2017) and Le et
al (2020) sounded energy consumption illustrate technology, moreover energy consumption
measured by energy intensity, investigated energy intensity positive effects with CO2 emission
in short run. (In this case, the meaning of short run is Macroeconomics meaning)
